"use strict";var d=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var b=(e,t)=>{for(var n in t)d(e,n,{get:t[n],enumerable:!0})},Z=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of O(t))!M.call(e,o)&&o!==n&&d(e,o,{get:()=>t[o],enumerable:!(r=z(t,o))||r.enumerable});return e};var v=e=>Z(d({},"__esModule",{value:!0}),e);var K={};b(K,{createOpenAI:()=>f,createTool:()=>g,default:()=>I,detectEnvironment:()=>m,generateText:()=>T,hello:()=>u});module.exports=v(K);var y=require("zod-to-json-schema");function g(e){let t=async n=>Promise.resolve(e.execute(n));return{name:e.name,description:e.description,parameters:e.parameters,execute:t}}function f(e){let t=(e.baseURL??"https://api-inference.modelscope.cn/v1").replace(/\/$/,""),n=e.apiKey;if(!n)throw new Error("apiKey is required");let r=o=>({provider:"openai",endpoint:`${t}/chat/completions`,model:o,apiKey:n});return r.baseURL=t,r.apiKey=n,r.chat=o=>r(o),r}async function T(e){let{messages:t,onToolCall:n}=e,r=[...t],o=new Map,c=e.tools;if(Array.isArray(c))for(let s of c)o.set(s.name,s);else if(c&&typeof c=="object")for(let[s,l]of Object.entries(c))o.set(s,l);let h=o.size?Array.from(o.values()).map(s=>({type:"function",function:{name:s.name,description:s.description,parameters:(0,y.zodToJsonSchema)(s.parameters)}})):void 0,x=`${("client"in e?e.client.baseURL:e.model.endpoint.replace(/\/chat\/completions$/,"")).replace(/\/$/,"")}/chat/completions`,A="client"in e?e.client.apiKey:e.model.apiKey,C="client"in e?e.model:e.model.model;for(;;){let l=(await fetch(x,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${A}`},body:JSON.stringify({model:C,messages:r,tools:h})}).then(a=>a.json())).choices?.[0]?.message;if(!l)throw new Error("No message returned");r.push(l);let p=l.tool_calls;if(!p||p.length===0)return{text:l.content};n&&p.map(i=>i.function.name).forEach(i=>n(i));for(let a of p){let i=o.get(a.function.name);if(!i)throw new Error(`Tool ${a.function.name} not found`);let R=i.parameters.parse(JSON.parse(a.function.arguments)),w=await i.execute(R);r.push({role:"tool",content:w,tool_call_id:a.id})}}}function m(){return typeof window<"u"&&typeof document<"u"?"browser":"node"}function u(e="world"){return`Hello, ${e}! from ${m()}`}var I={detectEnvironment:m,hello:u};0&&(module.exports={createOpenAI,createTool,detectEnvironment,generateText,hello});
//# sourceMappingURL=index.cjs.map