var FastAI=function(e,o){"use strict";function n(){return"undefined"!=typeof window&&"undefined"!=typeof document?"browser":"node"}function t(e="world"){return`Hello, ${e}! from ${n()}`}var r={detectEnvironment:n,hello:t};return e.createOpenAI=function(e){const o=(e.baseURL??"https://api-inference.modelscope.cn/v1").replace(/\/$/,""),n=e.apiKey;if(!n)throw new Error("apiKey is required");const t=e=>({provider:"openai",endpoint:`${o}/chat/completions`,model:e,apiKey:n});return t.baseURL=o,t.apiKey=n,t.chat=e=>t(e),t},e.default=r,e.detectEnvironment=n,e.generateText=async function(e){const{messages:n,onToolCall:t}=e,r=[...n],i=new Map,a=e.tools;if(Array.isArray(a))for(const e of a)i.set(e.name,e);else if(a&&"object"==typeof a)for(const[e,o]of Object.entries(a))i.set(e,o);const c=i.size?Array.from(i.values()).map(e=>({type:"function",function:{name:e.name,description:e.description,parameters:o.zodToJsonSchema(e.parameters)}})):void 0,s=`${("client"in e?e.client.baseURL:e.model.endpoint.replace(/\/chat\/completions$/,"")).replace(/\/$/,"")}/chat/completions`,l="client"in e?e.client.apiKey:e.model.apiKey,p="client"in e?e.model:e.model.model;for(;;){const e=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({model:p,messages:r,tools:c})}).then(e=>e.json()),o=e.choices?.[0]?.message;if(!o)throw new Error("No message returned");r.push(o);const n=o.tool_calls;if(!n||0===n.length)return{text:o.content};if(t){n.map(e=>e.function.name).forEach(e=>t(e))}for(const e of n){const o=i.get(e.function.name);if(!o)throw new Error(`Tool ${e.function.name} not found`);const n=o.parameters.parse(JSON.parse(e.function.arguments)),t=await o.execute(n);r.push({role:"tool",content:t,tool_call_id:e.id})}}},e.hello=t,Object.defineProperty(e,"__esModule",{value:!0}),e}({},zodToJsonSchema);
//# sourceMappingURL=fast-ai.global.min.js.map
